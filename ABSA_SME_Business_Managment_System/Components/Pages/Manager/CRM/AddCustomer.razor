@page "/manager/crm/add-customer"
@using ABSA_SME_Business_Managment_System.Components.Models
@inject AppDbContext DbContext
@using Microsoft.EntityFrameworkCore

<h3>Add Customer</h3>

<div class="card p-3" style="max-width: 600px;">

    <EditForm Model="@customer" OnValidSubmit="HandleValidSubmit" FormName="AddCustomerForm">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label class="form-label">Name</label>
            <InputText @bind-Value="customer.Name" class="form-control" />
        </div>

        <div class="mb-3">
            <label class="form-label">Email</label>
            <InputText @bind-Value="customer.Email" class="form-control" />
        </div>

        <div class="mb-3">
            <label class="form-label">Phone</label>
            <InputText @bind-Value="customer.Phone" class="form-control" />
        </div>

        <button type="submit" class="btn btn-primary">Add Customer</button>
    </EditForm>

    @if (submitted)
    {
        <div class="alert alert-success mt-3">
            ✅ Customer added successfully!
        </div>
    }

    <!-- Debug information directly on the page -->
    <hr />
    <h5>DEBUG INFO</h5>
    <p>Name: @customer.Name</p>
    <p>Email: @customer.Email</p>
    <p>Phone: @customer.Phone</p>

</div>

@code {
    private Customer customer = new Customer();  // Initialized before the form renders
    private bool submitted = false;

    private async Task HandleValidSubmit()
    {
        // Debug output will also appear here in console (optional)
        Console.WriteLine($"DEBUG: Name={customer.Name}, Email={customer.Email}, Phone={customer.Phone}");

        try
        {
            DbContext.Customers.Add(customer);
            await DbContext.SaveChangesAsync();

            submitted = true;
            customer = new Customer(); // reset form
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
    }
}
